import{MongoClient as e}from"mongodb";import{saveJson as t,loadJson as r}from"jnu-abc";let a=async t=>{try{let r=new e(t.url);await r.connect();let a=r.db(t.dbName);return{client:r,db:a}}catch(e){return console.error("MongoDB 연결 오류:",e),null}},s=async e=>{try{await e.close()}catch(e){console.error("MongoDB 연결 해제 오류:",e)}},n=async(e,t,r,a={})=>{try{let s=e.collection(t),n=await s.find(r,a).toArray();return{success:!0,data:n}}catch(e){return{success:!1,error:e instanceof Error?e.message:"알 수 없는 오류"}}},c=async(e,t,r)=>{let a=t.startSession();try{let t=[];return await a.withTransaction(async()=>{for(let s of r){let r;let n=e.collection(s.collection);switch(s.operation){case"insert":r=await n.insertOne(s.query,{session:a});break;case"update":r=await n.updateOne(s.query,s.update,{session:a});break;case"delete":r=await n.deleteOne(s.query,{session:a})}r&&t.push(r)}}),{success:!0,data:t}}catch(e){return{success:!1,error:e instanceof Error?e.message:"알 수 없는 오류"}}finally{await a.endSession()}},o=async(e,r)=>{try{let a=await e.listCollections().toArray(),s={};for(let t of a){let r=t.name,a=await e.collection(r).find({}).toArray();s[r]=a}return await t(r,s),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"알 수 없는 오류"}}},i=async(e,t,a)=>{let s=t.startSession();try{let t=await r(a);return await s.withTransaction(async()=>{for(let[r,a]of Object.entries(t))if(Array.isArray(a)&&a.length>0){let t=e.collection(r);await t.insertMany(a,{session:s})}}),{success:!0}}catch(e){return{success:!1,error:e instanceof Error?e.message:"알 수 없는 오류"}}finally{await s.endSession()}};export{a as connect,s as disconnect,n as executeQuery,c as executeTransaction,o as backup,i as restore};