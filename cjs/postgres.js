"use strict";var r;Object.defineProperty(exports,"__esModule",{value:!0}),!function(r,e){for(var t in e)Object.defineProperty(r,t,{enumerable:!0,get:e[t]})}(exports,{backup:function(){return a},executeQuery:function(){return t},executeTransaction:function(){return s},restore:function(){return o}});const e=(r=require("fs"))&&r.__esModule?r:{default:r},t=async(r,e,t=[])=>{try{let s=await r.query(e,t);return{success:!0,rows:s.rows,data:s.rows,error:void 0}}catch(r){return console.error("쿼리 실행 실패:",r),{success:!1,rows:void 0,data:void 0,error:r instanceof Error?r:Error(r instanceof Error?r.message:"알 수 없는 오류가 발생했습니다.")}}},s=async(r,e)=>{try{await r.query("BEGIN");let t=[];try{for(let s of e){let e=await r.query(s.query,s.params||[]);t.push(e.rows)}return await r.query("COMMIT"),{success:!0,data:t}}catch(e){throw await r.query("ROLLBACK"),e}}catch(r){return{success:!1,error:r}}},a=async(r,t)=>{try{let{rows:s}=await r.query("SELECT table_name FROM information_schema.tables WHERE table_schema = 'public'");if(0===s.length)throw Error("백업할 테이블이 없습니다.");let a={};for(let{table_name:e}of s){let{rows:t}=await r.query(`SELECT * FROM ${e}`);a[e]=t}return await e.default.promises.writeFile(t,JSON.stringify(a,null,2)),{success:!0,tables:Object.keys(a)}}catch(r){return console.error("백업 실행 중 오류:",r),{success:!1,error:r}}},o=async(r,t)=>{try{if(!e.default.existsSync(t))return console.error("백업 파일을 찾을 수 없습니다:",t),{success:!1,error:Error("백업 파일을 찾을 수 없습니다.")};let s=JSON.parse(e.default.readFileSync(t,"utf-8"));await r.query("BEGIN");try{for(let[e,t]of Object.entries(s))if(Array.isArray(t)&&t.length>0){let s=Object.keys(t[0]),a=s.map((r,e)=>`$${e+1}`).join(","),o=`INSERT INTO ${e} (${s.join(",")}) VALUES (${a})`;for(let e of t)await r.query(o,Object.values(e))}return await r.query("COMMIT"),{success:!0}}catch(e){throw await r.query("ROLLBACK"),e}}catch(r){return console.error("복원 실행 중 오류:",r),{success:!1,error:r}}};